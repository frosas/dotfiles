#!/bin/bash

set -e

diff-new() {
  diff \
    --new-line-format="- %L" \
    --old-line-format="" \
    --unchanged-line-format="" \
    "$1" "$2" \
  || true
}

title() {
  echo -e "\n## $1\n"
}

BASE_PATH="$(dirname $0)/../.."

title "Homebrew"

# Update before running `brew doctor` to avoid the "Your Homebrew is outdated" warning
echo "brew update..."
brew update >/dev/null

echo -e "\nbrew doctor..."
brew doctor || true

echo -e "\nbrew cask doctor..."
brew cask doctor

# TODO Is this necessary having `brew bundle check`?
echo -e "\nbrew outdated (upgrade with \`brew upgrade\`)..."
brew outdated

# TODO Is this necessary having `brew bundle check`?
echo -e "\nbrew cask outdated (upgrade with \`brew cask upgrade\`)..."
brew cask outdated

echo -e "\nbrew cleanup..."
brew cleanup

echo -e "\nUnknown installed formulae and casks (update with \`brew bundle dump --global --force\`):"
brew bundle cleanup --global

echo -e "\nMissing known formulae and casks:"
brew bundle check --global --verbose

title "npm"

echo "Outdated packages:"
npm outdated -g --depth 0 || echo "Update with \`npm update -g\`"

title "macOS Software Update"

softwareupdate -l
