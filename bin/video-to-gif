#!/bin/bash

# Based on http://superuser.com/questions/556029/how-do-i-convert-a-video-to-gif-using-ffmpeg-with-reasonable-quality

set -e

source="$1"
fps=10
width=-1
source_palette="/tmp/$source-palette.png"

ffmpeg -i "$source" -vf "fps=$fps,scale=$width:-1:flags=lanczos,palettegen" -y "$source_palette"
ffmpeg -i "$source" -i "$source_palette" -filter_complex "fps=$fps,scale=$width:-1:flags=lanczos[x];[x][1:v]paletteuse" "$source.gif"
