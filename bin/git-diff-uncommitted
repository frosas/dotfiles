#!/bin/bash

# Like git diff but for all uncommited files (including untracked ones)
#
# Based on http://stackoverflow.com/a/4864668/337172

function echo-info {
    BLUE="\033[1;34m"
    echo -e "$BLUE$1"
}

function title {
    echo-info
    echo-info "#"
    echo-info "# $1"
    echo-info "#"
    echo-info
}

DIFF="git diff --color --ignore-space-at-eol "$@""

(
    echo-info "Note: spaces are ignored."

    title STAGED
    $DIFF --cached

    title UNSTAGED
    $DIFF

    title UNTRACKED
    # TODO Make it work when filenames have spaces
    for FILE in `git ls-files --others --exclude-standard`; do
        $DIFF /dev/null $FILE
    done

) | less -R # TODO --quit-if-one-screen doesn't work
